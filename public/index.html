<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Reversi Mone ðŸ¥Š VS May.C ðŸ‘‹</title>
  <style>
    body { font-family: Arial; text-align: center; }
    .cell { width: 40px; height: 40px; background: green; display: inline-block; margin: 2px; border-radius: 5px; cursor: pointer; }
    .red { background: deeppink; }
    .purple { background: purple; }
    #plateau { margin-top: 20px; }
  </style>
</head>
<body>
  <h1>Reversi Mone ðŸ¥Š VS May.C ðŸ‘‹</h1>
  <input id="partie" placeholder="Nom de la partie">
  <select id="joueur">
    <option value="Mone">Je suis Mone ðŸ¥Š</option>
    <option value="May.C">Je suis May.C ðŸ‘‹</option>
  </select>
  <button onclick="rejoindre()">Rejoindre la partie</button>
  <a id="whatsapp" target="_blank">ðŸ“² WhatsApp adversaire</a>

  <p id="info"></p>
  <p id="score"></p>
  <div id="plateau"></div>
  <br>
  <button onclick="rejouer()">Rejouer</button>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    let partie = "", joueur = "", tour = "", plateau = [];

    function rejoindre() {
      partie = document.getElementById("partie").value.trim();
      joueur = document.getElementById("joueur").value;
      if (!partie) return alert("Entrez un nom de partie");

      socket.emit('rejoindre', { partie, joueur });
      const link = `https://wa.me/?text=Rejoins moi ici : https://reversi-mone-vs-mayc.onrender.com (partie: ${partie})`;
      document.getElementById("whatsapp").href = link;
    }

    socket.on('maj', data => {
      plateau = data.plateau;
      tour = data.tour;
      render();
    });

    function jouer(x, y) {
      if (tour !== joueur || plateau[y][x] !== '') return;
      socket.emit('jouer', { partie, x, y });
    }

    function rejouer() {
      socket.emit('rejouer', partie);
    }

    function render() {
      document.getElementById("info").innerText = `Vous Ãªtes : ${joueur} ${joueur === "Mone" ? "ðŸ¥Š" : "ðŸ‘‹"} | La partie commence !`;
      let red = 0, purple = 0;
      let html = "";
      for (let y = 0; y < 8; y++) {
        for (let x = 0; x < 8; x++) {
          const c = plateau[y][x];
          if (c === 'red') red++;
          if (c === 'purple') purple++;
          html += `<div class="cell ${c}" onclick="jouer(${x},${y})"></div>`;
        }
        html += "<br>";
      }
      document.getElementById("plateau").innerHTML = html;
      document.getElementById("score").innerText = `Score : Mone ðŸ¥Š ${red} - ${purple} ðŸ‘‹ May.C`;
    }
  </script>
</body>
</html>